var $selectedVignetteId,$productData,$cTimeTemplate,$cVignetteTemplate,$cSummaryTemplate,$vignetteList=[{vignetteId:"D1-01",vignetteTime:"Heti",vignetteTitle:"D1 heti matrica",vignettePrice:"2975 Ft"},{vignetteId:"D1-02",vignetteTime:"Havi",vignetteTitle:"D1 havi matrica",vignettePrice:"4780 Ft"},{vignetteId:"D1-03",vignetteTime:"Eves orszagos",vignetteTitle:"D1 eves orszagos matrica",vignettePrice:"42980 Ft"},{vignetteId:"D1-04",vignetteTime:"Eves megyei",vignetteTitle:"D1 eves megyei matrica",vignettePrice:"5000 Ft"}],$shippingAddress=null,$defaultShipping={stairway:"A",lastName:"Doe",prefix:"Dr.",firstName:"John",street:"Teszt utca",type:"Private",comment:"",city:"Budapest",postalCode:"1234",streetNumber:"32.",floor:"2",taxNumber:"10203040",countryCode:"HU",door:"5",companyName:"Test Inc."},$v={licensePlate:"ASD321",type:"CAR"},$summaryData={vehicle:$v,address:$defaultShipping},app=new Framework7({root:"#app",name:"My App",id:"com.myapp.test",panel:{swipe:"left"},routes:[{name:"vignetteList",path:"/vignettelist/",page:"vignettelist",url:"/",on:{pageInit:function(e,t){var a=$cVignetteTemplate({vignetteList:$vignetteList});$$(".list-template").html(a)}}},{name:"summary",path:"/summary/",url:"/summary.html",on:{pageInit:function(e,t){if(null!=$v&&null!=$shippingAddress){var a=$cSummaryTemplate({summaryData:$summaryData});$$(".summary-template").html(a)}}}},{name:"time",path:"/time/",url:"/",on:{pageInit:function(e,t){if(console.log("time oldal betoltodik"),null!=$selectedVignetteId){switch($vignette={time:"unknown",title:"unknown"},$selectedVignetteId){case"D1-01":$vignette={title:"matol 10 nap",time:"10 nap"};break;case"D1-02":$vignette={title:"1 honap",time:"1 honap"};break;case"D1-03":$vignette={title:"1 ev",time:"1 ev"};break;case"D1-04":$vignette={title:"1 ev regionalis",time:"1 ev regionalis"}}$productData={vignetteId:$selectedVignetteId,vignette:$vignette};var a=$cTimeTemplate({productData:$productData});console.log(a.productData),$$(".time-template").html(a);var n=["January","February","March","April","May","June","July","August","September","October","November","December"],i=app.calendar.create({containerEl:"#demo-calendar-inline-container",value:[new Date],weekHeader:!1,renderToolbar:function(){return'<div class="toolbar calendar-custom-toolbar no-shadow"><div class="toolbar-inner"><div class="left"><a href="#" class="link icon-only"><i class="icon icon-back '+("md"===app.theme?"color-black":"")+'"></i></a></div><div class="center"></div><div class="right"><a href="#" class="link icon-only"><i class="icon icon-forward '+("md"===app.theme?"color-black":"")+'"></i></a></div></div></div>'},on:{init:function(e){$$(".calendar-custom-toolbar .center").text(n[e.currentMonth]+", "+e.currentYear),$$(".calendar-custom-toolbar .left .link").on("click",function(){i.prevMonth()}),$$(".calendar-custom-toolbar .right .link").on("click",function(){i.nextMonth()})},monthYearChangeStart:function(e){$$(".calendar-custom-toolbar .center").text(n[e.currentMonth]+", "+e.currentYear)}}})}}}},{path:"/done/",url:"/done.html"},{path:"/failed/",url:"/failed.html"},{path:"/redirect",url:"/redirect.html",on:{pageInit:function(e,t){var a=t.route.query;console.log(a),getPaymentState(a.paymentId)}}}],navbar:{hideOnPageScroll:!1,iosCenterTitle:!0},statusbar:{enabled:!0,overlay:!0,iosOverlaysWebView:!1,iosBackgroundColor:"#1A80BB",materialBackgroundColor:"#1A80BB"}}),$$=Dom7,barionMarket=new BarionMarket,mainView=app.views.create(".view-main");function startPayment(){$$("#buyVignetteButton").addClass("disabled").attr("disabled","disabled");var e=$selectedVignetteId;console.log(e);var t=new Array;t.push(e),app.request({method:"POST",url:"/payment/start",data:JSON.stringify({vIds:t,locale:"hu-HU",currency:"HUF"}),contentType:"application/json",traditional:!0,dataType:"json",error:function(e,t,a){alert("ERROR: "+a+"\r\nStatus: "+t)},success:function(e,t,a){"success"==t?redirectToBarionPaymentGateway(e.paymentId):alert("Request finished with status code '"+t+"', could not process response.")},complete:function(){$$("#buyVignetteButton").removeClass("disabled").removeAttr("disabled")}})}function getPaymentState(e){"undefined"!=e&&app.request({method:"GET",url:"/payment/paymentstate?paymentId="+e,error:function(e,t,a){alert("ERROR: "+a+"\r\nStatus: "+t)},success:function(e,t,a){"Succeeded"==e.status?mainView.router.navigate("/done/",{animate:!1}):mainView.router.navigate("/failed/",{animate:!1})},complete:function(){$$("#payWithBarionButton").removeClass("disabled").removeAttr("disabled")}})}function redirectToBarionPaymentGateway(e){window.location.href="https://test.barion.com/pay?id="+e}mainView.router.allowPageChange=!0,app.statusbar.setIosTextColor("white"),app.statusbar.setBackgroundColor("#1A80BB"),app.on("init",function(){0<$$("html.ios").length?($$("body").scrollTop(20),$$(".view").scrollTop(20)):app.statusbar.hide()}),$$(document).on("DOMContentLoaded",function(){var e=$$("script#timeTemplate").html();$cTimeTemplate=Template7.compile(e);var t=$$("script#vignetteTemplate").html();$cVignetteTemplate=Template7.compile(t);var a=$$("script#summaryTemplate").html(),n=($cSummaryTemplate=Template7.compile(a))($summaryData);$$(".list-template").html(n),$$(document).on("click","#payWithBarionButton",startPayment),$$(document).on("click","#buyVignetteButton",startPayment),$$(document).on("click","#setShippingButton",barionMarket.getShippingAddress),$$(document).on("click","#resultButton",barionMarket.closePlugin),$$(document).on("click","#exitButton",barionMarket.closePlugin),$$(document).on("click","#changeAddressButton",barionMarket.selectAddress),$$(document).on("click","#selectVignetteButton",function(){$$(this).find(".card").addClass("touched"),$selectedVignetteId=$$(this).attr("data-vignette-id"),mainView.router.navigate("/vignettelist/")}),$$(document).on("click",".vignette-type-list-item",function(){$$(this).find(".card").addClass("touched"),console.log("menjunk a time oldalra most azonnal!"),$selectedVignetteId=$$(this).attr("data-vignette-id"),mainView.router.navigate("/time/")}),$$(document).on("click",".backToList-link",function(e){e.preventDefault(),e.stopPropagation(),mainView.router.back("/booklist/",{force:!0})}),$$(document).on("click",".backToDetails-link",function(e){e.preventDefault(),e.stopPropagation(),mainView.router.back("/bookdetails/",{force:!0})}),$$(document).on("click",".book-link",function(){$selectedBook=$$(this).attr("data-book-id")}),$$(document).on("click",".navbar, .statusbar",function(e){return e.preventDefault(),e.stopPropagation(),!1})});