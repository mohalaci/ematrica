var $productData;var $vehicle={licensePlate:"",type:"",countryCode:""};var $data={licensePlate:"",selectedVignette:"",selectedVignetteId:"",dateOfValidity:"",image:""};var $highwaysVignetteTypes=[];var $yearlyCountyVignetteTypes=[];var $cContentTemplate;var $cVignetteTypesTemplate;var app=new Framework7({root:"#app",name:"My App",id:"com.myapp.test",panel:{swipe:"left"},routes:[{name:"vignetteTypes",path:"/vignetteTypes/",url:"/",on:{pageInit:function(b,a){getVignetteTypesForVehicleCategory($vehicle.type,function c(e){$highwaysVignetteTypes=e.highways;$yearlyCountyVignetteTypes=e.yearlyCounty;var d=$cVignetteTypesTemplate({highways:e.highways,yearlyCounty:e.yearlyCounty});$$(".page-content").html(d)})}}},{name:"main",path:"/main/",page:"main",url:"/",on:{pageInit:function(b,a){initMainPage()}}},{name:"redirect",path:"/redirect/",page:"redirect",on:{pageInit:function(b,a){console.log("loasdfasfasdf")}}},{path:"/done/",url:"/done.html"},{path:"/failed/",url:"/failed"}],navbar:{hideOnPageScroll:false,iosCenterTitle:true},statusbar:{enabled:true,overlay:true,iosOverlaysWebView:false,iosBackgroundColor:"#0097DB",materialBackgroundColor:"#0097DB"}});var $$=Dom7;var barionMarket=new BarionMarket();var mainView=app.views.create(".view-main");mainView.router.allowPageChange=true;app.statusbar.setIosTextColor("white");app.statusbar.setBackgroundColor("#0097DB");app.on("init",function(){if($$("html.device-ios").length>0){$$("body").scrollTop(20);$$(".view").scrollTop(20)}else{app.statusbar.hide();$$("body").scrollTop(20);$$(".view").scrollTop(20)}});function initMainPage(){var b=$cContentTemplate($data);$$(".page-content").html(b);$$("#payWithBarionButton").hide();var a=app.calendar.create({inputEl:"#demo-calendar-modal",openIn:"customModal",minDate:new Date(),maxDate:new Date(new Date().getFullYear(),11,31),header:true,footer:true,animate:true,dateFormat:"MM dd yyyy",on:{change:function(d,c){console.log(c);$data.dateOfValidity=c;showBuyButton()}}})}function showBuyButton(){if($data.licensePlate!=null&&$data.selectedVignetteId!=null&&$data.dateOfValidity!=null){$$("#payWithBarionButton").show()}}$$(document).on("DOMContentLoaded",function(){var b=$$("script#vignetteTypesTemplate").html();$cVignetteTypesTemplate=Template7.compile(b);var a=$$("script#contentTemplate").html();$cContentTemplate=Template7.compile(a);initMainPage();if($$("html.device-ios").length>0){$$("body").scrollTop(20);$$(".view").scrollTop(20)}else{app.statusbar.hide();$$("body").scrollTop(20);$$(".view").scrollTop(20)}$$(document).on("click","#payWithBarionButton",startPayment);$$(document).on("click","#buyVignetteButton",startPayment);$$(document).on("click","#setShippingButton",barionMarket.getShippingAddress);$$(document).on("click","#resultButton",barionMarket.closePlugin);$$(document).on("click","#exitButton",barionMarket.closePlugin);$$(document).on("click","#changeAddressButton",barionMarket.selectAddress);$$(document).on("click","#changeVehicleButton",barionMarket.getVehicle);$$(document).on("click","#selectVignetteType",function(){var c=$$(this).attr("data-vignette-id");$data.selectedVignetteId=c;var d=c.split("-");if(d!=null&&d.length>2){$yearlyCountyVignetteTypes.forEach(function(e){if(e.productId==c){$data.selectedVignette=e.productDescription+" "+e.productCounty;return}})}else{$highwaysVignetteTypes.forEach(function(e){if(e.productId==c){$data.selectedVignette=e.productDescription;return}})}console.log(c);mainView.router.back("/main/",{force:true})});$$(document).on("click","#showVignetteTypes",function(){if($vehicle.type!=""){mainView.router.navigate("/vignetteTypes/")}else{app.toast.create({closeTimeout:3000,text:"At first please select a vehicle.",position:"center"}).open()}});$$(document).on("click",".backToList-link",function(c){c.preventDefault();c.stopPropagation();mainView.router.back("/booklist/",{force:true})});$$(document).on("click",".navbar, .statusbar",function(c){c.preventDefault();c.stopPropagation();return false})});function getVignetteTypesForVehicleCategory(a,b){if(a!=undefined){app.request({method:"GET",url:"/products?type="+a,error:function(e,c,d){alert("ERROR: "+d+"\r\nStatus: "+c)},success:function(d,c,e){if(c==200){b(JSON.parse(d))}else{}}})}}function startPayment(){$$("#payWithBarionButton").addClass("disabled").attr("disabled","disabled");var b=$data.selectedVignetteId;console.log(b);var a=new Array();a.push(b);app.request({method:"POST",url:"/payment/start",data:JSON.stringify({vIds:a,locale:"hu-HU",currency:"HUF"}),contentType:"application/json",traditional:true,dataType:"json",error:function(e,c,d){alert("ERROR: "+d+"\r\nStatus: "+c)},success:function(d,c,e){if(c==200){redirectToBarionPaymentGateway(d.paymentId)}else{alert("Request finished with status code '"+c+"', could not process response.")}},complete:function(){$$("#buyVignetteButton").removeClass("disabled").removeAttr("disabled")}})}function getPaymentState(a){if(a!="undefined"){app.request({method:"GET",url:"/payment/paymentstate?paymentId="+a,error:function(d,b,c){alert("ERROR: "+c+"\r\nStatus: "+b)},success:function(c,b,d){if(JSON.parse(c).status=="Succeeded"){mainView.router.navigate("/done/",{animate:false})}else{mainView.router.navigate("/failed/",{animate:false})}},complete:function(){$$("#payWithBarionButton").removeClass("disabled").removeAttr("disabled")}})}}function redirectToBarionPaymentGateway(a){window.location.href="https://test.barion.com/pay?id="+a}function setVehicle(c){console.log(c);var a=JSON.parse(c);$vehicle={licensePlate:a.licensePlate,countryCode:a.countryCode,type:a.category};$data.licensePlate=$vehicle.licensePlate;$data.image=getIconByVehicleCategory($vehicle.type);var b=$cContentTemplate($data);$$(".page-content").html(b);showBuyButton()}function getIconByVehicleCategory(b){var a="/img/vehicle_car.png";if(b!=undefined){switch(b.toLowerCase()){case"bus":a="/img/vehicle_bus.png";break;case"car":a="/img/vehicle_car.png";break;case"van":a="/img/vehicle_van.png";break;case"trailer":a="/img/vehicle_trailer.png";break;case"motor":a="/img/vehicle_motor.png";break;default:a="/img/vehicle_car.png";break}}return a};